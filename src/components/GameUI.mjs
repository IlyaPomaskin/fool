// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Card from "../fool/Card.mjs";
import * as Curry from "rescript/lib/es6/curry.js";
import * as Table from "../fool/Table.mjs";
import * as Utils from "../Utils.mjs";
import * as React from "react";
import * as CardUI from "./CardUI.mjs";
import * as PlayerUI from "./PlayerUI.mjs";
import * as Belt_List from "rescript/lib/es6/belt_List.js";
import * as GameUtils from "../fool/GameUtils.mjs";
import * as Belt_Option from "rescript/lib/es6/belt_Option.js";

function GameUI$InLobbyUI(Props) {
  var game = Props.game;
  return React.createElement("div", undefined, Utils.uiStr("inLobby"), React.createElement("br", undefined), React.createElement("br", undefined), Utils.uiStr("players:"), React.createElement("br", undefined), React.createElement("div", undefined, Utils.uiList(game.players, (function (p) {
                        return React.createElement(PlayerUI.make, {
                                    player: p,
                                    key: p.id
                                  });
                      }))), React.createElement("br", undefined), Utils.uiStr("ready:"), React.createElement("br", undefined), React.createElement("div", undefined, Utils.uiList(game.ready, (function (p) {
                        return React.createElement(PlayerUI.make, {
                                    player: p,
                                    key: p.id
                                  });
                      }))));
}

var InLobbyUI = {
  make: GameUI$InLobbyUI
};

function GameUI$Button(Props) {
  var disabledOpt = Props.disabled;
  var pressedOpt = Props.pressed;
  var classNameOpt = Props.className;
  var onClickOpt = Props.onClick;
  var children = Props.children;
  var disabled = disabledOpt !== undefined ? disabledOpt : false;
  var pressed = pressedOpt !== undefined ? pressedOpt : false;
  var className = classNameOpt !== undefined ? classNameOpt : "";
  var onClick = onClickOpt !== undefined ? onClickOpt : Utils.noop;
  return React.createElement("button", {
              className: Utils.cx([
                    className,
                    "p-1 border rounded-md border-solid border-slate-500 bg-slate-100 shadow-sm hover:shadow-md",
                    pressed ? Utils.selected : "",
                    disabled ? "border-slate-400 text-slate-400 cursor-not-allowed shadow-none hover:shadow-none" : ""
                  ]),
              disabled: disabled,
              onClick: onClick
            }, children);
}

var Button = {
  make: GameUI$Button
};

function GameUI$ClientUI(Props) {
  var classNameOpt = Props.className;
  var player = Props.player;
  var game = Props.game;
  var onMove = Props.onMove;
  var className = classNameOpt !== undefined ? classNameOpt : "";
  var match = React.useState(function () {
        return [
                undefined,
                undefined
              ];
      });
  var setBeat = match[1];
  var match$1 = match[0];
  var beatBy = match$1[1];
  var toBeat = match$1[0];
  var handleSelectToBeat = function (isToCard, card) {
    return Curry._1(setBeat, (function (param) {
                  var beatBy = param[1];
                  var toBeat = param[0];
                  if (isToCard) {
                    var isSame = Belt_Option.getWithDefault(Belt_Option.map(toBeat, (function (param) {
                                return Utils.equals(card, param);
                              })), false);
                    if (isSame) {
                      return [
                              undefined,
                              beatBy
                            ];
                    } else {
                      return [
                              card,
                              beatBy
                            ];
                    }
                  }
                  var isSame$1 = Belt_Option.getWithDefault(Belt_Option.map(beatBy, (function (param) {
                              return Utils.equals(card, param);
                            })), false);
                  if (isSame$1) {
                    return [
                            toBeat,
                            undefined
                          ];
                  } else {
                    return [
                            toBeat,
                            card
                          ];
                  }
                }));
  };
  var handleBeat = function (param) {
    if (toBeat !== undefined && beatBy !== undefined) {
      Curry._1(setBeat, (function (param) {
              return [
                      undefined,
                      undefined
                    ];
            }));
      return Curry._1(onMove, {
                  TAG: /* Beat */1,
                  _0: player,
                  _1: toBeat,
                  _2: beatBy
                });
    }
    
  };
  var handleMove = function (card) {
    return Curry._1(onMove, {
                TAG: /* Move */3,
                _0: player,
                _1: card
              });
  };
  var handleTake = function (param) {
    Curry._1(setBeat, (function (param) {
            return [
                    undefined,
                    undefined
                  ];
          }));
    return Curry._1(onMove, {
                TAG: /* Take */0,
                _0: player
              });
  };
  var isDef = GameUtils.isDefender(game, player);
  React.useEffect((function () {
          if (!isDef) {
            Curry._1(setBeat, (function (param) {
                    return [
                            undefined,
                            undefined
                          ];
                  }));
          }
          
        }), [isDef]);
  var match$2 = GameUtils.isAttacker(game, player);
  var match$3 = GameUtils.getPlayerGameState(game, player);
  var tmp;
  switch (match$3) {
    case /* Playing */0 :
        var disabled = isDef ? !Table.hasCards(game.table) : !GameUtils.isPlayerCanMove(game, player);
        var isCardSelected = function (card) {
          return Belt_Option.getWithDefault(Belt_Option.map(beatBy, (function (param) {
                            return Utils.equals(card, param);
                          })), false);
        };
        var isCardDisabled = function (by) {
          return Belt_Option.getWithDefault(Belt_Option.map(toBeat, (function (to) {
                            return !Card.isValidBeat(to, by, game.trump);
                          })), false);
        };
        tmp = React.createElement(CardUI.deck, {
              deck: player.cards,
              disabled: disabled,
              isCardSelected: isCardSelected,
              isCardDisabled: isCardDisabled,
              onCardClick: isDef ? (function (param) {
                    return handleSelectToBeat(false, param);
                  }) : handleMove
            });
        break;
    case /* Done */1 :
        tmp = Utils.uiStr("Done");
        break;
    case /* Lose */2 :
        tmp = Utils.uiStr("Lose");
        break;
    case /* Draw */3 :
        tmp = Utils.uiStr("Draw");
        break;
    
  }
  var tmp$1;
  if (isDef) {
    var isCardSelected$1 = function (card) {
      return Belt_Option.getWithDefault(Belt_Option.map(toBeat, (function (param) {
                        return Utils.equals(card, param);
                      })), false);
    };
    var isCardDisabled$1 = function (to) {
      return Belt_Option.getWithDefault(Belt_Option.map(beatBy, (function (by) {
                        return !Card.isValidBeat(to, by, game.trump);
                      })), false);
    };
    tmp$1 = React.createElement(CardUI.table, {
          className: "my-1",
          isCardSelected: isCardSelected$1,
          isCardDisabled: isCardDisabled$1,
          table: game.table,
          onCardClick: (function (param) {
              return handleSelectToBeat(true, param);
            })
        });
  } else {
    tmp$1 = null;
  }
  return React.createElement("div", {
              className: Utils.cx([
                    className,
                    "p-1 border rounded-md border-solid border-slate-500"
                  ])
            }, React.createElement("div", {
                  className: "mb-1"
                }, Utils.uiStr("Player: "), React.createElement(PlayerUI.Short.make, {
                      className: "inline-block",
                      player: player
                    }), isDef ? Utils.uiStr(" def") : (
                    match$2 ? Utils.uiStr(" att") : null
                  )), tmp, React.createElement("div", {
                  className: "grid grid-flow-col gap-1"
                }, React.createElement(GameUI$Button, {
                      disabled: !GameUtils.isCanPass(game, player),
                      pressed: GameUtils.isPassed(game, player),
                      onClick: (function (param) {
                          return Curry._1(onMove, {
                                      TAG: /* Pass */2,
                                      _0: player
                                    });
                        }),
                      children: Utils.uiStr("pass")
                    }), React.createElement(GameUI$Button, {
                      disabled: !GameUtils.isCanTake(game, player),
                      onClick: handleTake,
                      children: Utils.uiStr("take")
                    }), React.createElement(GameUI$Button, {
                      disabled: !isDef || Belt_Option.isNone(toBeat) || Belt_Option.isNone(beatBy),
                      onClick: handleBeat,
                      children: Utils.uiStr("beat")
                    })), React.createElement("div", {
                  className: "mt-1"
                }, tmp$1), React.createElement("div", undefined, Utils.uiStr("to: " + Belt_Option.getWithDefault(Belt_Option.map(toBeat, Card.cardToString), "None")), Utils.uiStr(" by: " + Belt_Option.getWithDefault(Belt_Option.map(beatBy, Card.cardToString), "None"))));
}

var ClientUI = {
  make: GameUI$ClientUI
};

function GameUI$InProgressUI(Props) {
  var game = Props.game;
  var onMove = Props.onMove;
  return React.createElement("div", undefined, React.createElement("div", undefined, Utils.uiStr("Attacker: "), React.createElement(PlayerUI.Short.make, {
                      className: "inline-block",
                      player: game.attacker
                    })), React.createElement("div", undefined, Utils.uiStr("Defender: "), React.createElement(PlayerUI.Short.make, {
                      className: "inline-block",
                      player: game.defender
                    })), React.createElement("div", undefined, Utils.uiList(game.players, (function (p) {
                        return React.createElement("div", {
                                    key: p.id,
                                    className: "inline-block mr-3"
                                  }, React.createElement(PlayerUI.Short.make, {
                                        className: "inline-block",
                                        player: p
                                      }), Utils.uiStr(" (" + String(Belt_List.length(p.cards)) + ")"), Utils.uiStr(GameUtils.isPassed(game, p) ? " (pass) " : ""), Utils.uiStr(GameUtils.isAttacker(game, p) ? " (ATT) " : ""), Utils.uiStr(GameUtils.isDefender(game, p) ? " (DEF) " : ""));
                      }))), React.createElement("div", undefined, Utils.uiStr("Trump: "), React.createElement(CardUI.trump, {
                      suit: game.trump,
                      className: "inline-block"
                    })), React.createElement("div", undefined, Utils.uiStr("Deck: " + String(Belt_List.length(game.deck)))), React.createElement("div", {
                  className: "flex flex-wrap"
                }, Utils.uiList(game.players, (function (p) {
                        return React.createElement(GameUI$ClientUI, {
                                    className: "m-1 flex-initial w-96",
                                    player: p,
                                    game: game,
                                    onMove: onMove,
                                    key: p.id
                                  });
                      }))));
}

var InProgressUI = {
  make: GameUI$InProgressUI
};

function GameUI(Props) {
  var game = Props.game;
  if (game.TAG === /* InLobby */0) {
    return React.createElement(GameUI$InLobbyUI, {
                game: game._0
              });
  } else {
    return React.createElement("div", undefined);
  }
}

var make = GameUI;

export {
  InLobbyUI ,
  Button ,
  ClientUI ,
  InProgressUI ,
  make ,
  
}
/* react Not a pure module */
