// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Base from "./Base.mjs";
import * as Card from "../fool/Card.mjs";
import * as Curry from "rescript/lib/es6/curry.js";
import * as Table from "../fool/Table.mjs";
import * as Utils from "../Utils.mjs";
import * as React from "react";
import * as CardUI from "./CardUI.mjs";
import * as PlayerUI from "./PlayerUI.mjs";
import * as GameUtils from "../fool/GameUtils.mjs";
import * as Belt_Option from "rescript/lib/es6/belt_Option.js";

function ClientUI(Props) {
  var classNameOpt = Props.className;
  var player = Props.player;
  var game = Props.game;
  var onMove = Props.onMove;
  var className = classNameOpt !== undefined ? classNameOpt : "";
  var match = React.useState(function () {
        return [
                undefined,
                undefined
              ];
      });
  var setBeat = match[1];
  var match$1 = match[0];
  var beatBy = match$1[1];
  var toBeat = match$1[0];
  var handleSelectToBeat = function (isToCard, card) {
    return Curry._1(setBeat, (function (param) {
                  var beatBy = param[1];
                  var toBeat = param[0];
                  if (isToCard) {
                    var isSame = Belt_Option.getWithDefault(Belt_Option.map(toBeat, (function (param) {
                                return Utils.equals(card, param);
                              })), false);
                    if (isSame) {
                      return [
                              undefined,
                              beatBy
                            ];
                    } else {
                      return [
                              card,
                              beatBy
                            ];
                    }
                  }
                  var isSame$1 = Belt_Option.getWithDefault(Belt_Option.map(beatBy, (function (param) {
                              return Utils.equals(card, param);
                            })), false);
                  if (isSame$1) {
                    return [
                            toBeat,
                            undefined
                          ];
                  } else {
                    return [
                            toBeat,
                            card
                          ];
                  }
                }));
  };
  var handleBeat = function (param) {
    if (toBeat !== undefined && beatBy !== undefined) {
      Curry._1(setBeat, (function (param) {
              return [
                      undefined,
                      undefined
                    ];
            }));
      return Curry._1(onMove, {
                  TAG: /* Beat */1,
                  _0: player,
                  _1: toBeat,
                  _2: beatBy
                });
    }
    
  };
  var handleMove = function (card) {
    return Curry._1(onMove, {
                TAG: /* Move */3,
                _0: player,
                _1: card
              });
  };
  var handleTake = function (param) {
    Curry._1(setBeat, (function (param) {
            return [
                    undefined,
                    undefined
                  ];
          }));
    return Curry._1(onMove, {
                TAG: /* Take */0,
                _0: player
              });
  };
  var isDef = GameUtils.isDefender(game, player);
  React.useEffect((function () {
          if (!isDef) {
            Curry._1(setBeat, (function (param) {
                    return [
                            undefined,
                            undefined
                          ];
                  }));
          }
          
        }), [isDef]);
  var match$2 = GameUtils.isAttacker(game, player);
  var match$3 = GameUtils.getPlayerGameState(game, player);
  var tmp;
  switch (match$3) {
    case /* Playing */0 :
        var disabled = isDef ? !Table.hasCards(game.table) : !GameUtils.isPlayerCanMove(game, player);
        var isCardSelected = function (card) {
          return Belt_Option.getWithDefault(Belt_Option.map(beatBy, (function (param) {
                            return Utils.equals(card, param);
                          })), false);
        };
        var isCardDisabled = function (by) {
          return Belt_Option.getWithDefault(Belt_Option.map(toBeat, (function (to) {
                            return !Card.isValidBeat(to, by, game.trump);
                          })), false);
        };
        tmp = React.createElement(CardUI.deck, {
              deck: player.cards,
              disabled: disabled,
              isCardSelected: isCardSelected,
              isCardDisabled: isCardDisabled,
              onCardClick: isDef ? (function (param) {
                    return handleSelectToBeat(false, param);
                  }) : handleMove
            });
        break;
    case /* Done */1 :
        tmp = Utils.uiStr("Done");
        break;
    case /* Lose */2 :
        tmp = Utils.uiStr("Lose");
        break;
    case /* Draw */3 :
        tmp = Utils.uiStr("Draw");
        break;
    
  }
  var tmp$1;
  if (isDef) {
    var isCardSelected$1 = function (card) {
      return Belt_Option.getWithDefault(Belt_Option.map(toBeat, (function (param) {
                        return Utils.equals(card, param);
                      })), false);
    };
    var isCardDisabled$1 = function (to) {
      return Belt_Option.getWithDefault(Belt_Option.map(beatBy, (function (by) {
                        return !Card.isValidBeat(to, by, game.trump);
                      })), false);
    };
    tmp$1 = React.createElement(CardUI.table, {
          className: "my-1",
          isCardSelected: isCardSelected$1,
          isCardDisabled: isCardDisabled$1,
          table: game.table,
          onCardClick: (function (param) {
              return handleSelectToBeat(true, param);
            })
        });
  } else {
    tmp$1 = null;
  }
  return React.createElement("div", {
              className: Utils.cx([
                    className,
                    "p-1 border rounded-md border-solid border-slate-500"
                  ])
            }, React.createElement("div", {
                  className: "mb-1"
                }, Utils.uiStr("Player: "), React.createElement(PlayerUI.Short.make, {
                      className: "inline-block",
                      player: player
                    }), isDef ? Utils.uiStr(" def") : (
                    match$2 ? Utils.uiStr(" att") : null
                  )), tmp, React.createElement("div", {
                  className: "grid grid-flow-col gap-1"
                }, React.createElement(Base.Button.make, {
                      disabled: !GameUtils.isCanPass(game, player),
                      pressed: GameUtils.isPassed(game, player),
                      onClick: (function (param) {
                          return Curry._1(onMove, {
                                      TAG: /* Pass */2,
                                      _0: player
                                    });
                        }),
                      children: Utils.uiStr("pass")
                    }), React.createElement(Base.Button.make, {
                      disabled: !GameUtils.isCanTake(game, player),
                      onClick: handleTake,
                      children: Utils.uiStr("take")
                    }), React.createElement(Base.Button.make, {
                      disabled: !isDef || Belt_Option.isNone(toBeat) || Belt_Option.isNone(beatBy),
                      onClick: handleBeat,
                      children: Utils.uiStr("beat")
                    })), React.createElement("div", {
                  className: "mt-1"
                }, tmp$1), React.createElement("div", undefined, Utils.uiStr("to: " + Belt_Option.getWithDefault(Belt_Option.map(toBeat, Card.cardToString), "None")), Utils.uiStr(" by: " + Belt_Option.getWithDefault(Belt_Option.map(beatBy, Card.cardToString), "None"))));
}

var make = ClientUI;

export {
  make ,
  
}
/* Base Not a pure module */
